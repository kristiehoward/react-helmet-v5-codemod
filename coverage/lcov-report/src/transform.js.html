<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/transform.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">src</a> transform.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>85/85</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>40/40</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>15/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>85/85</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">42x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">21x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">20x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">22x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">module.exports = function(file, api) {
  const j = api.jscodeshift;
  const root = j(file.source);
&nbsp;
  // Given text, return a comment that can be used as children to a JSX element
  const createComment = text =&gt; {
    const el = j.jsxEmptyExpression();
    el.comments = [j.block(text)];
    return j.jsxExpressionContainer(el);
  };
&nbsp;
&nbsp;
  // Keep track of any title attributes we may find so we can apply them after
  let titleAttributes = [];
&nbsp;
  // Return true if the JSXAttribute supplied should be left in props
  const isPropAttr = a =&gt; {
    // The following attributes are the only ones that should be left as props
    return ["defaultTitle", "encodeSpecialCharacters", "onChangeClientState", "titleTemplate"].includes(a.name.name);
  };
&nbsp;
  // Return true if the Property supplied should be given as a child instead of
  // a prop when creating a new jsxElement
  const isChildProperty = p =&gt; {
    const name = p.key &amp;&amp; p.key.name;
    return name === "innerHTML" || name === "cssText";
  };
&nbsp;
  // Given a property, return a jsxExpressionContainer with that property inside
  const convertPropertyToContainer = prop =&gt; {
    // amp=undefined
    if (prop.value.type === "Identifier") {
      return null;
    }
    const contents = prop.value.type === "Literal"
      ? j.literal(prop.value.rawValue)
      : j.templateLiteral(prop.value.quasis, prop.value.expressions);
    return j.jsxExpressionContainer(contents);
  };
&nbsp;
  // Converts object property to a jsxAttribute to be used on a jsxElement
  // ex: {name: "description"}
  // gets converted into a jsxAttribute with name="description"
  const convertPropertyToAttr = prop =&gt; {
    const value = prop.value.value
      ? j.literal(prop.value.value)
      : // protect against template literals
        convertPropertyToContainer(prop);
    return j.jsxAttribute(j.jsxIdentifier(prop.key.name), value);
  };
&nbsp;
  // Given a name, an array of jsx attributes, and an array of children, return
  // a jsxElement with those attributes and children
  const createElementWithAttrsAndChildren = (name, attrs, children) =&gt; {
    const opening = j.jsxOpeningElement(name);
    opening.attributes = attrs;
    let closing = j.jsxClosingElement(name);
    if (!children || !children.length) {
      opening.selfClosing = true;
      closing = null;
    }
    return j.jsxElement(opening, closing, children);
  };
&nbsp;
  // Given an attribute from the &lt;Helmet&gt; element, create a tag with the
  // value of the expression as a JSX container body
  // and comments surrounding it so that the user can easily find them
  // Ex: meta={getMeta()} ==&gt; &lt;meta&gt;{getMeta()}&lt;/meta&gt;
  const convertAttrToCommentedTags = a =&gt; {
    const comment = createComment("WARNING: Unable to translate the following tag");
    const children = [j.jsxExpressionContainer(a.value.expression)];
    return [comment, createElementWithAttrsAndChildren(a.name, [], children)];
  };
&nbsp;
  // Given properties, an array for attributes, and an array for children,
  // convert each property to a container or an array and save them in either
  // the attributes or children arrays
  const convertPropertiesToTag = (properties, name) =&gt; {
    const attrs = [];
    const children = [];
    properties.forEach(p =&gt; {
      if (isChildProperty(p)) {
        // create jsxcontainer and push onto children
        children.push(convertPropertyToContainer(p));
      } else {
        attrs.push(convertPropertyToAttr(p));
      }
    });
    return createElementWithAttrsAndChildren(name, attrs, children)
  };
&nbsp;
  // Given an attribute (prop) on the &lt;Helmet&gt; tag, convert it into the
  // appropriate tag(s) and return an array of tags
  const convertAttrToTags = a =&gt; {
    const tags = [];
    const type = a.name.name;
    let tag;
&nbsp;
    switch (type) {
      case "title":
        tags.push(createElementWithAttrsAndChildren(a.name, [], [a.value]));
        tags.push(j.literal("\n"));
        break;
      case "titleAttributes":
        // Create and save jsx attributes that we can later apply to the &lt;title&gt;
        titleAttributes = a.value.expression.properties.map(convertPropertyToAttr);
        break;
      case "htmlAttributes":
        // Create an &lt;html&gt; tag with those attributes
        const htmlAttrs = a.value.expression.properties.map(convertPropertyToAttr);
        a.name.name = "html";
        tag = createElementWithAttrsAndChildren(a.name, htmlAttrs, []);
        tags.push(tag, j.literal("\n"));
        break;
      case "base":
        tag = convertPropertiesToTag(a.value.expression.properties, a.name);
        tags.push(tag, j.literal("\n"));
        break;
      case "meta":
      case "link":
      case "script":
      case "noscript":
      case "style":
        // Could be a different JSX expression - either way, we don't know how
        // to translate this, so mark it with a comment for the user to translate
        // by hand. ex. meta={getMeta()} instead of meta={{ ... }}
        if (a.value.expression &amp;&amp; !a.value.expression.elements) {
          tags.push(...convertAttrToCommentedTags(a), j.literal("\n"));
          break;
        }
        a.value.expression.elements.forEach(e =&gt; {
          tag = convertPropertiesToTag(e.properties, a.name);
          tags.push(tag, j.literal("\n"));
        });
        break;
      default:
        break;
    }
    return tags;
  };
&nbsp;
  let result = root.findJSXElements("Helmet").replaceWith(p =&gt; {
    const children = [];
    // For each of the &lt;Helmet&gt; attributes, process them and add them to the
    // children array if appropriate
    p.node.openingElement.attributes.forEach(a =&gt; {
      if (a.type === "JSXSpreadAttribute") {
        throw new Error("Cannot process JSX spread attributes");
      }
      // Do nothing if the attribute should remain as a prop on the &lt;Helmet&gt; tag
      if (isPropAttr(a)) {
        return;
      }
      const newTags = convertAttrToTags(a);
      children.push(...newTags);
    });
    const name = p.node.openingElement.name;
    // Remove the props that are now children
    const attrs = p.node.openingElement.attributes.filter(isPropAttr);
    if (children.length) {
      // Add a newline for formatting if children were found
      children.unshift(j.literal("\n"));
    }
    return createElementWithAttrsAndChildren(name, attrs, children)
  });
  // If there are titleAttributes found, add those to the &lt;title&gt; tag
  if (titleAttributes &amp;&amp; titleAttributes.length) {
    result = result.findJSXElements("title").replaceWith(p =&gt; {
      return createElementWithAttrsAndChildren(p.node.name, titleAttributes, p.node.children);
    });
  }
  return result.toSource();
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Jul 26 2017 22:06:44 GMT-0700 (PDT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
